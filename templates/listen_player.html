{% extends "base.html" %}
{% block head_content %}
    <title>Listen {{ source.name }} - RadioChWeb</title>
{% endblock %}
{% block styles %}
<style>
.player { max-width:720px; width:100%; padding:1.5rem; border-radius:8px; box-shadow:0 6px 18px rgba(0,0,0,.08); text-align:center; 
  background-image: linear-gradient(rgba(255,255,255,0.55), rgba(255,255,255,0.55)), url('/static/images/new_radio_background.svg');}
.stream-url { word-break:break-all; font-size:.9rem; color:#6c757d; margin-top:.5rem; }
</style>
{% endblock %}

{% block body_content %}
  <div class="player">
    <h5 class="mb-3">{{ source.name or 'Live Stream' }}</h5>

    <!-- native audio control; browser decides codec support -->
    <audio id="streamPlayer" controls preload="none" style="width:100%;">
      <source src="{{ source.stream_url }}" type="audio/mpeg">
      <!-- add additional source types if you know them -->
      Your browser does not support the audio element.
    </audio>

    <div class="stream-url mt-3">
      <small>Stream: <a href="{{ source.stream_url }}" target="_blank" rel="noopener noreferrer">{{ source.stream_url }}</a></small>
    </div>
    <div class="stream-type mt-2">
      <small>Type: {{ source.stream_type.display_name if source.stream_type else 'Unknown' }}</small>
    </div>
    {% if metadata %}
      {% if metadata.available %}
        <div class="stream-metadata mt-2" style="font-size:.85rem; text-align:left;">
          {% if metadata.current_track %}
            <div><strong>Now playing:</strong> {{ metadata.current_track }}</div>
          {% endif %}
          {% if metadata.genre %}
            <div><strong>Genre:</strong> {{ metadata.genre }}</div>
          {% endif %}
          {% if metadata.bitrate %}
            <div><strong>Bitrate:</strong> {{ metadata.bitrate }} kb/s</div>
          {% endif %}
        </div>
      {% elif metadata.error_message %}
        <div class="stream-metadata mt-2" style="font-size:.85rem; color:#a00;">
          <small>{{ metadata.error_message }}</small>
        </div>
      {% endif %}
    {% endif %}
    <div class="mt-3">
      <button class="btn btn-sm btn-outline-secondary" onclick="window.close()">Close</button>
    </div>
  </div>
{% endblock %}
{% block scripts %}
  <script>
    // Autoplay often blocked: optional attempt (muted first if desired)
    const audio = document.getElementById('streamPlayer');
    // Try autoplay if you want (may be blocked by browser):
    // audio.play().catch(()=>{/* user gesture required */});
  </script>
{% endblock %}